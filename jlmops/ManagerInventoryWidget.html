<div id="manager-inventory-widget" class="card h-100">
  <div class="card-header">
    <h5 class="mb-0">Inventory</h5>
  </div>
  <div class="card-body">
    <p>Loading...</p>
  </div>
</div>

<script>
  /**
   * Placeholder for a global error display function.
   * In a full application, this would likely be provided by a shared utility.
   * @param {Error} error - The error object.
   */
  function showError(error) {
    console.error("Error in ManagerInventoryWidget:", error);
    const widgetBody = document.querySelector('#manager-inventory-widget .card-body');
    if (widgetBody) {
      widgetBody.innerHTML = `<p class="text-danger">Error: ${error.message || error}</p>`;
    }
  }

  /**
   * Populates the manager inventory widget.
   * @param {Object} data - The inventory data from the backend.
   */
  function updateManagerInventoryView(data) {
    const widgetBody = document.querySelector('#manager-inventory-widget .card-body');
    if (!widgetBody) return;

    if (!data) {
      widgetBody.innerHTML = `<p class="text-danger">Error: No data received from server.</p>`;
      return;
    }
    if (data.error) {
      widgetBody.innerHTML = `<p class="text-danger">${data.error}</p>`;
      return;
    }

    let html = ''; // Removed first <hr>

    // Counts Section
    html += '<h6>Counts</h6>';
    html += '<p>Negative Inventory: <strong>' + (data.openNegativeInventoryTasksCount || 0) + '</strong></p>';
    html += '<p>Inventory Count: <strong>' + (data.openInventoryCountTasksCount || 0) + '</strong></p>';
    html += '<p>Inventory Review: <strong>' + (data.openInventoryCountReviewTasksCount || 0) + '</strong></p>';
    html += '<hr>'; // This HR remains

    // Brurya Section
    html += '<h6>Brurya</h6>';
    html += '<p>Products: <strong>' + (data.bruryaProductCount || 0) + '</strong></p>';
    html += '<p>Total: <strong>' + (data.bruryaTotalStock || 0) + '</strong></p>';
    // Removed last <hr>

    widgetBody.innerHTML = html;
  }

  // Initial data load for this view
  google.script.run.withSuccessHandler(updateManagerInventoryView).withFailureHandler(showError).WebAppInventory_getInventoryWidgetData();
</script>
