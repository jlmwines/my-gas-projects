<div id="inventory-widget" style="padding: 0;">
  <p>Loading...</p>
</div>

<script>
  /**
   * Populates the inventory widget.
   * @param {Object} result - The inventory data from the backend.
   */
  function updateInventoryView(result) {
    const widget = document.getElementById('inventory-widget');
    if (result.error) {
      widget.innerHTML = `<p class="text-danger">${result.error}</p>`;
      return;
    }

    const data = result.data;
    let html = '<h5>Inventory Overview</h5>';

    // Brurya Summary
    html += '<p>Brurya Products: <strong>' + (result.bruryaProductCount || 0) + '</strong></p>';
    html += '<p>Brurya Total Stock: <strong>' + (result.bruryaTotalStock || 0) + '</strong></p>';
    html += '<hr>';

    // Open Inventory Tasks
    html += '<h6>Open Inventory Tasks</h6>';
    html += '<p>Negative Inventory Tasks: <strong>' + (result.openNegativeInventoryTasksCount || 0) + '</strong></p>';
    html += '<p>Inventory Count Tasks: <strong>' + (result.openInventoryCountTasksCount || 0) + '</strong></p>';
    html += '<p>Inventory Count Review Tasks: <strong>' + (result.openInventoryCountReviewTasksCount || 0) + '</strong></p>';
    html += '<hr>';

    // Comax Inventory Export
    html += '<h6>Comax Inventory Export</h6>';
    if (result.comaxInventoryExportCount > 0) {
      html += `<p>${result.comaxInventoryExportCount} items are ready for export.</p><button onclick="runComaxInventoryExport()">Generate Comax Inventory Export</button>`;
      // TODO: Implement runComaxInventoryExport() in WebApp.js (or similar) to generate the export file and create a 'task.confirmation.comax_inventory_export' task.
    } else {
      html += '<p>No inventory items are currently ready for Comax export.</p>';
    }
    html += '<hr>';

    // Comax Inventory Export Confirmation
    html += '<h6>Comax Inventory Export Confirmation</h6>';
    if (result.openComaxInventoryConfirmationTask) { // Assuming only one task can be open
      html += `<p>${result.openComaxInventoryConfirmationTask.notes}</p><button onclick="confirmComaxInventoryImport('${result.openComaxInventoryConfirmationTask.id}')">Confirm Import</button>`;
    } else {
      html += '<p>No pending Comax inventory export confirmations.</p>';
    }

    widget.innerHTML = html;
  }

  // Initial data load for this view
  google.script.run.withSuccessHandler(updateInventoryView).withFailureHandler(showError).getInventoryWidgetData();
</script>
