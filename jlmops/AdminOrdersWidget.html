<div id="orders-widget" style="padding: 0;">
  <p>Loading...</p>
</div>

<script>
  /**
   * Populates the orders widget.
   * @param {Object} data - The orders data from the backend.
   */
  function updateOrdersWidget(data) {
    const widget = document.getElementById('orders-widget');
    if (data.error) {
      widget.innerHTML = `<p class="text-danger">${data.error}</p>`;
      return;
    }

    let html = '<h5>Orders</h5>';
    html += '<p>On-Hold Orders: <strong>' + (data.onHoldCount || 0) + '</strong></p>';
    html += '<p>Processing Orders: <strong>' + (data.processingCount || 0) + '</strong></p>';
    html += '<p>Packing Slips Ready: <strong>' + (data.packingSlipsReadyCount || 0) + '</strong></p>';
    html += '<hr>';
    html += '<h6>Comax Export</h6>';
    if (data.comaxExportOrderCount > 0) {
      html += `<p>${data.comaxExportOrderCount} orders are ready for export.</p><button onclick="runComaxExport()">Generate Comax Order Export</button>`;
    } else {
      html += '<p>No orders are currently ready for Comax export.</p>';
    }
    html += '<hr><h5>Confirm Imports</h5>';
    if (data.openComaxConfirmationTasks && data.openComaxConfirmationTasks.length > 0) {
      html += '<ul>';
      data.openComaxConfirmationTasks.forEach(task => {
        html += `<li class="mb-2">${task.notes} <button class="btn btn-sm btn-outline-primary ml-2" onclick="confirmComaxImport('${task.id}')">Confirm Import</button></li>`;
      });
      html += '</ul>';
    } else {
      html += '<p>No pending Comax import confirmations.</p>';
    }
    widget.innerHTML = html;
  }

  // Initial data load for this view
  google.script.run.withSuccessHandler(updateOrdersWidget).withFailureHandler(showError).getAdminOrdersData();
</script>