<div id="orders-widget" style="padding: 0;">
  <p>Loading...</p>
</div>

<script>
  /**
   * Populates the orders widget with new data from the backend.
   * @param {Object} data - The orders data from the backend.
   */
  function updateOrdersWidget(data) {
    const widget = document.getElementById('orders-widget');
    if (!data) {
      widget.innerHTML = `<p class="text-danger">Error: No data received from server.</p>`;
      return;
    }
    if (data.error) {
      widget.innerHTML = `<p class="text-danger">${data.error}</p>`;
      return;
    }

    // --- Update Counts ---
    let countsHtml = '<h5>Orders</h5>';
    countsHtml += '<hr>'; // Divider below widget title
    countsHtml += '<p>On-Hold Orders: <strong>' + (data.onHoldCount || 0) + '</strong></p>';
    countsHtml += '<p>Processing Orders: <strong>' + (data.processingCount || 0) + '</strong></p>';
    countsHtml += '<p>Packing Slips Ready: <strong>' + (data.packingSlipsReadyCount || 0) + '</strong></p>';
    
    // --- Rebuild the widget with new structure (preserves a clean slate) ---
    widget.innerHTML = countsHtml + 
      '<hr>' + // Divider below widget content
      '<div id="comax-persistent-count-area" style="margin-bottom: 0.5rem;">Comax Orders to Export: ' + (data.comaxExportOrderCount || 0) + '</div>';
  }

  // Initial data load for this view
  google.script.run.withSuccessHandler(updateOrdersWidget).withFailureHandler(showError).WebAppOrders_getOrdersWidgetData();
</script>