<div id="products-widget" style="padding: 0;">
  <p>Loading...</p>
</div>

<script>
  /**
   * Populates the products widget.
   * @param {Object} result - The products data from the backend.
   */
  function updateProductsWidget(result) {
    const widget = document.getElementById('products-widget');
    if (result.error) {
      widget.innerHTML = `<p class="text-danger">${result.error}</p>`;
      return;
    }

    const data = result.data;
    let html = '<h5>Product Tasks</h5>';

    const taskLabels = {
      'task.validation.sku_not_in_comax': 'SKU Not in Comax',
      'task.validation.translation_missing': 'Translation Missing',
      'task.validation.comax_internal_audit': 'Comax Internal Audit',
      'task.validation.field_mismatch': 'Field Mismatch',
      'task.validation.name_mismatch': 'Name Mismatch',
      'task.validation.web_master_discrepancy': 'Web Master Discrepancy',
      'task.validation.comax_master_discrepancy': 'Comax Master Discrepancy',
      'task.validation.row_count_decrease': 'Row Count Decrease',
      'task.validation.comax_not_web_product': 'Comax Not Web Product'
    };

    let hasTasks = false;
    for (const taskType in data) {
      if (data.hasOwnProperty(taskType) && data[taskType] > 0) {
        hasTasks = true;
        const label = taskLabels[taskType] || taskType;
        html += `<p>${label}: <span class="badge badge-warning">${data[taskType]}</span></p>`;
      }
    }

    if (!hasTasks) {
      html = '<p>No open product tasks.</p>';
    }

    widget.innerHTML = html;
  }

  // Initial data load for this view
  google.script.run.withSuccessHandler(updateProductsWidget).withFailureHandler(showError).getProductsWidgetData();
</script>