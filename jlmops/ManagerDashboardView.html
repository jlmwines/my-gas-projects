<div class="row">
  <div class="col-md-4" id="manager-orders-widget-placeholder">
    <p>Loading Manager Orders Widget...</p>
  </div>
  <div class="col-md-4" id="manager-inventory-widget-placeholder">
    <p>Loading Manager Inventory Widget...</p>
  </div>
  <div class="col-md-4" id="manager-products-widget-placeholder">
    <p>Loading Manager Products Widget...</p>
  </div>
</div>

<script>
  /**
   * A generic function to execute scripts within a string of HTML.
   * This function needs to be available in the global scope for the widgets.
   * @param {HTMLElement} element - The element containing the new HTML.
   */
  function executeScriptsInElement(element) {
    const scripts = Array.from(element.getElementsByTagName('script'));
    scripts.forEach(s => {
      const newScript = document.createElement('script');
      newScript.textContent = s.textContent;
      s.parentNode.replaceChild(newScript, s);
    });
  }

  /**
   * Displays an error message. This needs to be available for the widgets.
   * @param {Error} err - The error object from a failed google.script.run call.
   */
  function showError(err) {
    if (window.parent && window.parent.showError) {
      window.parent.showError(err);
    } else {
      console.error(err);
    }
  }

  /**
   * Loads a widget into a specified placeholder.
   * @param {string} widgetName - The name of the widget view to load.
   * @param {string} placeholderId - The ID of the div to load the widget into.
   */
  function loadWidget(widgetName, placeholderId) {
    const placeholder = document.getElementById(placeholderId);
    if (!placeholder) {
      console.error('Placeholder not found:', placeholderId);
      return;
    }
    
    google.script.run
      .withSuccessHandler(html => {
        placeholder.innerHTML = html;
        executeScriptsInElement(placeholder);
      })
      .withFailureHandler(err => {
        placeholder.innerHTML = `<p class="text-danger">Error loading ${widgetName}: ${err.message}</p>`;
      })
      .getView(widgetName);
  }

  // Load Manager Widgets
  // TODO: Create and load manager-specific widgets
  loadWidget('ManagerOrdersWidget', 'manager-orders-widget-placeholder');
  loadWidget('ManagerInventoryWidget', 'manager-inventory-widget-placeholder');
  loadWidget('ManagerProductsWidget', 'manager-products-widget-placeholder');

</script>